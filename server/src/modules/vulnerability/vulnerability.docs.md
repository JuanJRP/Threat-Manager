# Documentación API de Gestión de Activos - Vulnerabilidades

## Descripción General

Esta API proporciona endpoints para gestionar activos en el sistema. Sigue los principios REST y utiliza JSON para el intercambio de datos.

## URL Base

```
http://localhost:3000/api/vulnerability
```

## Modelo de Datos

### Estructura del Modelo Control

```typescript
interface VulnerabilityDTO {
  id: number; // @id @default(autoincrement())
  code: number; // Viene de la relaciòn desde controlDTO
  control_code: number; //Nùmero del control
  name: string; //Nombre vulnerabilidad
  description: string; //Descripciòn vulnerabilidad
}

```

## Endpoints

### 1. Crear Vulnerabilidad

Crea una nueva vulnerabilidad en el sistema.

**Endpoint:** `POST /`  
**Content-Type:** `application/json`

#### Cuerpo de la Petición

```json
{
  "control_code": 101,
  "name": "Example vulnerability",
  "description": "Vulnerability description"
}
```

#### Respuestas

- `201 Created`: Control creado exitosamente

```json
{
  "id": 1,
  "control_code": 101,
  "name": "Example vulnerability",
  "description": "Vulnerability description"
}
```

### 2. Obtener Todos las vulnerabilidades

Recupera todos las vulnerabilidades del sistema.

**Endpoint:** `GET /`

#### Respuesta Exitosa (200 OK)

```json
[
  {
    "id": 1,
    "control_code": 101,
    "name": "Example vulnerability",
    "description": "Vulnerability description",
    "code": {
      "id": 1,
      "code": 101,
      "description_iso": "ISO description example",
      "description_city_hall": "City hall description example"
    }
  }
]
```

### 3. Obtener vulnerabilidad por ID

Recupera una vulnerabilidad específicoa por su ID.

**Endpoint:** `GET /:id`

#### Parámetros de Ruta

- `id`: ID numérico de la vulnerabilidad

#### Respuesta Exitosa (200 OK)

```json
{
  "id": 1,
  "control_code": 101,
  "name": "Example vulnerability",
  "description": "Vulnerability description",
  "code": {
    "id": 1,
    "code": 101,
    "description_iso": "ISO description example",
    "description_city_hall": "City hall description example"
  }
}
```

### 4. Actualizar vulnerabilidad por id

Actualiza una vulnerabilidad por un id específico.

**Endpoint:** `PUT /:id`

#### Parámetros de Ruta

- `id`: ID numérico de la vulnerabilidad

### Ejemplo

```json
{
  "name": "Updated vulnerability name",
  "description": "Updated vulnerability description"
}
```

### Resultado

```json
{
  "id": 1,
  "control_code": 101,
  "name": "Updated vulnerability name",
  "description": "Updated vulnerability description",
  "code": {
    "id": 1,
    "code": 101,
    "description_iso": "ISO description example",
    "description_city_hall": "City hall description example"
  }
}
```
#### Respuesta Exitosa (200 OK)

### 5. Eliminar  una vulnerabilidad por id

Elimina una única vulnerabilidad por ID.

**Endpoint:** `DELETE /:id`

#### Parámetros de Ruta

- `id`: ID numérico del control

### Respuesta

```json
{
  "message": "Vulnerability deleted successfully"
}
```



### Relaciones

- `code`: Debe existir en la tabla `Control`
- `risk`: Debe existir en la tabla `Risk`

## Manejo de Errores

Todos los endpoints devuelven errores en el siguiente formato:

```json
{
  "message": "Descripción del error",
  "err": "Detalles técnicos del error (opcional)"
}
```

### Códigos de Estado HTTP

- `200`: Operación exitosa
- `201`: Creación exitosa
- `400`: Error de validación o solicitud incorrecta
- `404`: Si no existe
- `409`: Si hay datos duplicados
- `500`: Error interno del servidor
